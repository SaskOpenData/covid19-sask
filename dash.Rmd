---
title: "COVID in Saskatchewan"
output: 
  flexdashboard::flex_dashboard:
    orientation: rows
    vertical_layout: fill
    source_code: "https://github.com/SaskOpenData/covid19-sask"
---

```{r setup, include=FALSE}
library(flexdashboard)
library(readr)
library(dygraphs)
library(xts)
source('./utils.R')

indata <- readr::read_csv('./data/cases-sk.csv')
cases <- xts(indata$Cases, order.by=indata$Date)
colnames(cases) <- c('Cases')
```

Row 
-----------------------------------------------------------------------

### Current cases
```{r}
casesCurr <- indata[nrow(indata), "Cases"]
valueBox(casesCurr, 
         icon = "fa-stethoscope",
         color = ifelse(casesCurr > 5, "warning", ifelse(casesCurr > 100, "danger", "primary"))
)
```

### Daily growth
```{r}
dailyGrowth <- cases[nrow(cases)][[1]]/cases[nrow(cases)-1][[1]]-1
valueBox(round(dailyGrowth*100,0), 
         icon = "fa-percent",
         color = ifelse(dailyGrowth > 0.3, "danger", "warning"))
```

### Deaths
```{r}
deathsCurr <- indata[nrow(indata), "Deaths"]
valueBox(deathsCurr, 
         icon = "fa-skull",
         color = ifelse(deathsCurr == 0, "success", "danger"))
```

### Recovered
```{r}
recoverCurr <- indata[nrow(indata), "Recovered"]
valueBox(recoverCurr, 
         icon = "fa-syringe",
         color = ifelse(recoverCurr > 0, "primary", "success"))
```


Row 
-----------------------------------------------------------------------

### Detection rate
```{r}
# detRate <- 0.7765
detRate <- round(estDetRate(indata$Cases, (indata$Hospitalized+indata$ICU))*100,0)
valueBox(detRate, 
         icon = "fa-percent",
         color = ifelse(detRate > .5, "success", ifelse(detRate > .25, "primary", "danger"))
)
```

### Doubling rate (days)
```{r}
doubRate <- round(doubTime(indata$Cases, 1:length(indata$Cases)), 1)
valueBox(doubRate, 
         icon = "fa-stethoscope",
         color = ifelse(doubRate > 5, "success", ifelse(doubRate < 2.5, "danger", "warning"))
)
```

### Forecasted cases (10-day)
```{r}
projectedCases <- floor(as.data.frame(projSimple(cases, 1:length(cases))$y)$fit)
fcastCases <- projectedCases[length(projectedCases)]
valueBox(fcastCases, 
         icon = "fa-stethoscope",
         color = "danger"
)
```

Row
-----------------------------------------------------------------------

### Cases chart

```{r}
indata$inferredCases <- floor(indata$Cases/(detRate/100))
dta <- cbind(cases, indata$inferredCases)
dygraph(dta, main = "COVID-19 Cases in Saskatchewan") 
```



