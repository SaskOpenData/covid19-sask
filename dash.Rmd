---
title: "COVID in Saskatchewan"
output: 
  flexdashboard::flex_dashboard:
    orientation: rows
    vertical_layout: fill
    source_code: "https://github.com/SaskOpenData/covid19-sask"
---

```{r setup, include=FALSE}
library(flexdashboard)
library(readr)
library(dygraphs)
library(xts)
source('./utils.R')

indata <- readr::read_csv('./data/cases-sk.csv')
cases <- xts(indata$Cases, order.by=indata$Date)
colnames(cases) <- c('Cases')
```

Summary
======================================================================

Row 
-----------------------------------------------------------------------

### Current cases
```{r}
casesCurr <- indata[nrow(indata), "Cases"]
valueBox(casesCurr, 
         icon = "fa-stethoscope",
         color = ifelse(casesCurr > 5, "warning", ifelse(casesCurr > 100, "danger", "primary"))
)
```

### Daily growth
```{r}
dailyGrowth <- cases[nrow(cases)][[1]]/cases[nrow(cases)-1][[1]]-1
valueBox(round(dailyGrowth*100,0), 
         icon = "fa-percent",
         color = ifelse(dailyGrowth > 0.3, "danger", "warning"))
```

### Deaths
```{r}
deathsCurr <- indata[nrow(indata), "Deaths"]
valueBox(deathsCurr, 
         icon = "fa-skull",
         color = ifelse(deathsCurr == 0, "success", "danger"))
```

### Recovered
```{r}
recoverCurr <- indata[nrow(indata), "Recovered"]
valueBox(recoverCurr, 
         icon = "fa-syringe",
         color = ifelse(recoverCurr > 0, "primary", "success"))
```


Row 
-----------------------------------------------------------------------

### Detection rate
```{r}
# detRate <- round(estDetRate(indata$Cases, (indata$Hospitalized+indata$ICU))*100,0)
detectionRate <- detRate(indata$Cases, indata$Deaths)
valueBox(round(detectionRate*100, 2), 
         icon = "fa-percent",
         color = ifelse(detectionRate > 50, "success", ifelse(detectionRate > 25, "primary", "danger"))
)
```

### Doubling rate (days)
```{r}
doubRate <- round(doubTime(indata$Cases, 1:length(indata$Cases)), 1)
valueBox(doubRate, 
         icon = "fa-stethoscope",
         color = ifelse(doubRate > 5, "success", ifelse(doubRate < 2.5, "danger", "warning"))
)
```

### Forecasted cases (10-day)
```{r}
projectedCases <- floor(as.data.frame(projSimple(cases, 1:length(cases))$y)$fit)
fcastCases <- projectedCases[length(projectedCases)]
valueBox(fcastCases, 
         icon = "fa-stethoscope",
         color = "danger"
)
```

### Inferred actual current cases
```{r}
indata$inferredCases <- floor(indata$Cases/detectionRate)
inferredCases <- indata$inferredCases[length(indata$Cases)]
valueBox(inferredCases, 
         icon = "fa-stethoscope",
         color = "danger"
)
```

Row
-----------------------------------------------------------------------

### Official cases chart

```{r}
# dta <- cbind(cases, indata$inferredCases)
# names(dta) <- c('Cases', 'InferredCases')
# dygraph(dta, main = "Official COVID-19 Cases in Saskatchewan") %>%
#   dySeries("InferredCases", axis = "y2")
dygraph(cases, main = "Official COVID-19 Cases in Saskatchewan", group='covidCases')
```




Policy tools
======================================================================

Row
-----------------------------------------------------------------------

### Unofficial inferred actual cases chart

```{r}
dta <- cbind(cases, indata$inferredCases)
names(dta) <- c('Cases', 'InferredCases')
# dygraph(dta, main = "Official COVID-19 Cases in Saskatchewan") %>%
#   dySeries("InferredCases", axis = "y2")
dygraph(dta$InferredCases, main = "Unofficial Actual COVID-19 Cases in Saskatchewan", group='covidCases')
```
